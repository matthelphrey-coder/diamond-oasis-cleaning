---
phase: 07-location-pages
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/locations/GoogleMapEmbed.tsx
  - app/locations/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /locations/henderson and see Henderson location page"
    - "Each location page displays Google Maps embed"
    - "Each location page displays contact info and service areas"
    - "LocalBusiness schema validates on each location page"
    - "All 8 location pages render without errors"
  artifacts:
    - path: "components/locations/GoogleMapEmbed.tsx"
      provides: "Client component for Google Maps iframe"
      min_lines: 15
    - path: "app/locations/[slug]/page.tsx"
      provides: "Dynamic location page template"
      exports: ["generateStaticParams", "generateMetadata"]
      min_lines: 100
  key_links:
    - from: "app/locations/[slug]/page.tsx"
      to: "@/data/locations.json"
      via: "import and find"
      pattern: "locations\\.locations\\.find"
    - from: "app/locations/[slug]/page.tsx"
      to: "@/lib/schema"
      via: "import generateLocalBusinessSchema"
      pattern: "import.*generateLocalBusinessSchema.*from.*@/lib/schema"
    - from: "app/locations/[slug]/page.tsx"
      to: "components/locations/GoogleMapEmbed"
      via: "import and render"
      pattern: "<GoogleMapEmbed"
---

<objective>
Create the dynamic location page template that generates all 8 individual location pages at build time.

Purpose: Each location page provides local SEO presence with unique content, Google Maps embed, contact info, service areas, and LocalBusiness schema markup.

Output:
- GoogleMapEmbed client component for safe iframe rendering
- Dynamic route template at /locations/[slug] generating 8 static pages
</objective>

<execution_context>
@C:\Users\matth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\matth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-location-pages/07-RESEARCH.md

@lib/schema.ts
@app/residential-cleaning/page.tsx
@data/locations.json
@data/services.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GoogleMapEmbed client component</name>
  <files>components/locations/GoogleMapEmbed.tsx</files>
  <action>
Create a client component to safely render Google Maps iframe embeds.

**File: components/locations/GoogleMapEmbed.tsx**

```typescript
"use client";

interface GoogleMapEmbedProps {
  mapEmbed: string;
  locationName: string;
}

export default function GoogleMapEmbed({ mapEmbed, locationName }: GoogleMapEmbedProps) {
  return (
    <div
      className="w-full h-[450px] rounded-lg overflow-hidden shadow-md"
      dangerouslySetInnerHTML={{ __html: mapEmbed }}
      aria-label={`Google Maps showing ${locationName} service area`}
    />
  );
}
```

**Why client component:**
- Iframes render differently on server vs client causing hydration mismatch
- dangerouslySetInnerHTML with dynamic content needs client-side handling
- Follow pattern from EstimateModal.tsx and booking page iframes
  </action>
  <verify>
File exists: `ls components/locations/GoogleMapEmbed.tsx`
Has "use client": `grep -l "use client" components/locations/GoogleMapEmbed.tsx`
  </verify>
  <done>
GoogleMapEmbed.tsx exists as client component, accepts mapEmbed string and locationName, renders iframe safely with proper accessibility label.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dynamic location page template</name>
  <files>app/locations/[slug]/page.tsx</files>
  <action>
Create the dynamic route page following the complete template from 07-RESEARCH.md.

**Critical Next.js 15+ requirements:**
- params is a Promise and MUST be awaited: `const { slug } = await params;`
- Type Props as `{ params: Promise<{ slug: string }> }`
- Set `export const dynamicParams = false` to enforce only pre-built routes

**Exports required:**
1. `dynamicParams = false` - Only allow statically generated paths
2. `generateStaticParams()` - Return array of 8 slugs from locations.json
3. `generateMetadata({ params })` - Dynamic title/description per location with canonical URL
4. Default page component

**generateStaticParams:**
```typescript
export function generateStaticParams() {
  return locations.locations.map((location) => ({
    slug: location.slug,
  }));
}
```

**generateMetadata:**
- Await params to get slug
- Find location by slug, return "Location Not Found" if not found
- Title: "House Cleaning in {displayName} Las Vegas | Diamond Oasis Cleaning"
- Description: Include displayName, first 3 service areas, phone number
- Set canonical URL via alternates.canonical

**Page component sections:**
1. Schema: BreadcrumbSchema + LocalBusinessSchema via SchemaMarkup
2. Hero: bg-primary, h1 "House Cleaning in {displayName}, Las Vegas"
3. Breadcrumbs: Home > Locations > {displayName}
4. Contact Info + Map (lg:grid-cols-2):
   - Left: Contact card (bg-background-alt) with name, address, phone, email
   - Right: GoogleMapEmbed component
5. Service Areas: flex-wrap centered tags (bg-white px-4 py-2 rounded-full)
6. Services Available: Grid of links to service pages from services.json
7. CTA: bg-primary, "Ready for a Sparkling Clean Home?"

**404 handling:**
- If location not found after awaiting params: call `notFound()` from next/navigation
- Check in both generateMetadata and page component

**Imports:**
- Metadata from "next"
- notFound from "next/navigation"
- Link from "next/link"
- SchemaMarkup from "@/components/seo/SchemaMarkup"
- Breadcrumbs from "@/components/layout/Breadcrumbs"
- GoogleMapEmbed from "@/components/locations/GoogleMapEmbed"
- generateBreadcrumbSchema, generateLocalBusinessSchema from "@/lib/schema"
- locations from "@/data/locations.json"
- services from "@/data/services.json"
  </action>
  <verify>
Build succeeds: `npm run build` - should show 8 static pages generated for /locations/*
Dev server: Visit each location URL (henderson, summerlin, las-vegas-south, etc.)
Schema test: Copy page source, paste into Google Rich Results Test - LocalBusiness should validate
  </verify>
  <done>
/locations/[slug] template generates 8 static pages at build time. Each page shows hero, breadcrumbs, contact info, Google Maps embed, service areas list, services grid, and CTA. LocalBusiness schema renders in page head.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes and shows 8 /locations/* routes generated
2. Visit /locations/henderson - page renders correctly
3. Visit /locations/summerlin - page renders correctly
4. Visit /locations/invalid-slug - returns 404
5. Google Maps iframe displays on each location page
6. Service areas display as pill/tag elements
7. LocalBusiness schema present in page source (search for "LocalBusiness")
8. Breadcrumbs show correct path (Home > Locations > {Location})
</verification>

<success_criteria>
- [ ] GoogleMapEmbed.tsx exists as "use client" component
- [ ] app/locations/[slug]/page.tsx exists with generateStaticParams
- [ ] dynamicParams = false is set
- [ ] All 8 location slugs generate static pages at build
- [ ] Each page has unique metadata (title, description, canonical)
- [ ] LocalBusiness schema renders on each page
- [ ] BreadcrumbList schema renders on each page
- [ ] Google Maps embed displays correctly
- [ ] Service areas listed for each location
- [ ] Invalid slugs return 404
- [ ] Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-location-pages/07-02-SUMMARY.md`
</output>
